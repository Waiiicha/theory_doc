<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>MPC 终端集设计方法 - 理论知识库</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>
  <link href='https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "MPC \u7ec8\u7aef\u96c6\u8bbe\u8ba1\u65b9\u6cd5";
    var mkdocs_page_input_path = "\u6a21\u578b\u9884\u6d4b\u63a7\u5236/04-MPC\u7ec8\u7aef\u96c6\u8bbe\u8ba1\u65b9\u6cd5.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> 理论知识库</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="tocbase current">
    
    
      


  <li class="navtree toctree-l1 inactive">
    <a class="" href="../..">Welcome to MkDocs</a>
  </li>
    
      
  <li class="navtree toctree-l1 label">
    <p class="caption">强化学习</p>
  </li>


  

  
    <li class="navtree toctree-l1 group">
      <ul class="navtree subnav-l1 current">
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0/%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/">基础概念</a>
  </li>
        
      </ul>
    </li>
    
      
  <li class="navtree toctree-l1 label">
    <p class="caption">模型预测控制</p>
  </li>


  

  
    <li class="navtree toctree-l1 group">
      <ul class="navtree subnav-l1 current">
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../01-%E5%B8%B8%E7%94%A8%E5%AE%9A%E7%90%86%E3%80%81%E7%9F%A9%E9%98%B5/">常用定理、矩阵</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../02-%E7%BA%BF%E6%80%A7%E6%97%A0%E7%BA%A6%E6%9D%9FMPC%E7%A8%B3%E5%AE%9A%E6%80%A7%E6%8E%A8%E5%AF%BC/">线性无约束MPC稳定性推导</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../03-%E6%9C%89%E9%99%90%E6%97%B6%E5%9F%9F%E7%BA%BF%E6%80%A7%E6%9C%89%E7%BA%A6%E6%9D%9FMPC%E7%A8%B3%E5%AE%9A%E6%80%A7%E6%8E%A8%E5%AF%BC/">有限时域线性有约束MPC稳定性推导</a>
  </li>
        
          


  
    
    <li class="navtree toctree-l2 page current">
      <a class="current" href="./">
        MPC 终端集设计方法
          <span class="toctree-expand"></span>
      </a>
    </li>
    
      



  <li class="toctree-l2 current">
    <ul class="subnav-l2 current">
    
      
        <li class="toctree-l3">
          <a class="toctree-l4" href="#_1">基于线性不等式的迭代的终端集设计方法</a>
        </li>
    
      
          

  <li class="toctree-l3">
    <a href="#_2">
      基于最大椭球集/半定规划的终端集求解
      <span class="toctree-expand"></span>
    </a>
  </li>



  <li class="toctree-l3">
    <ul class="subnav-l3 toc-hidden">
    
      
        <li class="toctree-l4">
          <a class="toctree-l5" href="#_3">内部稳定性</a>
        </li>
    
      
        <li class="toctree-l4">
          <a class="toctree-l5" href="#_4">约束处理</a>
        </li>
    
      
        <li class="toctree-l4">
          <a class="toctree-l5" href="#_5">优化问题构造</a>
        </li>
    
    </ul>
  </li>

      
    
      
        <li class="toctree-l3">
          <a class="toctree-l4" href="#_6">线性时变系统终端集求解（基于最大椭球集/半定规划）</a>
        </li>
    
    </ul>
  </li>


  
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../05-MPC%E7%A8%B3%E5%AE%9A%E6%80%A7%E7%9A%84%E5%BA%94%E7%94%A8/">MPC稳定性的应用</a>
  </li>
        
      </ul>
    </li>
    
  </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">理论知识库</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>模型预测控制 &raquo;</li>
        
      
    
    <li>MPC 终端集设计方法</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="mpc">MPC 终端集设计方法</h1>
<hr />
<h2 id="_1">基于线性不等式的迭代的终端集设计方法</h2>
<p>该方法要求所有状态约束和控制约束都是线性的，且分别表示，MPC 问题表述如下：</p>
<div class="arithmatex">\[
  \begin{aligned}
  \min_{u_{i|k}} J = &amp; \sum_{i=1}^{N-1} \left\|  x(i|k) \right\|_{ Q}^2 + \sum_{i=1}^{N} \left\|  u(i-1|k) \right\|_{ R}^2 + \left\|  x(N|k) \right\|_{P}^2 \\
  \text{subj.to.} \quad &amp;  x(0|k) =  x(k), \\
  &amp; x(i|k) \in \mathcal X \subseteq \{x \in R^{n_x} |  H_x x \leq h_x \}, \  \forall i = 0, 1, \ldots, N, \\
  &amp; u(i|k) \in \mathcal U \subseteq \{u \in R^{n_u} |  H_u u \leq h_u \}, \  \forall i = 0, 1, \ldots, N, \\
  &amp; x(i+1|k) =  A  x(i|k) +  B  u(i|k), \  \forall i = 0, 1, \ldots, N-1, \\
  &amp; x(N|k) \in \mathcal X_f \subset  \Omega.
  \end{aligned}
\]</div>
<p>选取由 LQR 算出的反馈增益<span class="arithmatex">\(K_{LQR}\)</span>作为最后一步状态<span class="arithmatex">\(x(N|k)\)</span>进入终端集后的控制策略。以<span class="arithmatex">\(x(N|k)\)</span>和<span class="arithmatex">\(u(N-1|k)\)</span>满足相应的状态约束、控制约束作为线性不等式迭代的初始条件。通过<span class="arithmatex">\(K_{LQR}\)</span>更新<span class="arithmatex">\(x(N+1|k)\)</span>和<span class="arithmatex">\(u(N|k)\)</span>，得到新的线性不等式约束，并通过线性规划求状态量、控制量的最大值，观察是否满足所有约束。若满足就将当前所有的线性不等式围成的多面体作为终端集（实际上就是不停地取交集），否则继续迭代。</p>
<p>该方法伪代码如下：</p>
<div class="admonition example">
<p class="admonition-title"><strong>算法 1</strong> 估计终端集<span class="arithmatex">\(\mathcal{X}_f\)</span>（Maximal Admissible Positive Invariant Set）</p>
<p><strong>输入</strong>: 系统矩阵<span class="arithmatex">\(A,B\)</span>，约束矩阵<span class="arithmatex">\(H_u, H_x\)</span>，约束向量<span class="arithmatex">\(h_u, h_x\)</span>
<strong>输出</strong>: 终端集<span class="arithmatex">\(\mathcal{X}_f\)</span></p>
<hr />
<p><strong>初始化阶段</strong></p>
<ol>
<li>计算闭环系统矩阵：<span class="arithmatex">\(A_K \leftarrow A - BK\)</span></li>
<li>
<p>构造增广增益矩阵：$K_{\text{aug}} \leftarrow \begin{bmatrix} K_{\text{LQR}} \ I \end{bmatrix} $
   其中<span class="arithmatex">\(K_{\text{LQR}}\)</span>为LQR最优增益矩阵</p>
</li>
<li>
<p>定义增广约束：<span class="arithmatex">\(H_{\text{aug}} \leftarrow \begin{bmatrix} H_u &amp; 0 \\ 0 &amp; H_x \end{bmatrix}, \quad h_{\text{aug}} \leftarrow \begin{bmatrix} h_u \\ h_x \end{bmatrix}\)</span></p>
</li>
<li>初始化迭代参数：<span class="arithmatex">\(t \leftarrow 0,\quad p_f \leftarrow 0,\  s \leftarrow \text{dim}(h), \ \mathcal{A}_{\text{LP}} \leftarrow \emptyset,\  \mathcal{B}_{\text{LP}} \leftarrow \emptyset\)</span></li>
</ol>
<hr />
<p><strong>迭代阶段</strong></p>
<p><strong>while</strong> <span class="arithmatex">\(p_f = 0\)</span> <strong>do</strong>:</p>
<ol>
<li>更新线性规划约束：<span class="arithmatex">\(\mathcal{A}_{\text{LP}} \leftarrow \begin{bmatrix} \mathcal{A}_{\text{LP}} \\ H_{\text{aug}}K_{\text{aug}}A_K^t \end{bmatrix}, \  \mathcal{B}_{\text{LP}} \leftarrow \begin{bmatrix} \mathcal{B}_{\text{LP}} \\ h_{\text{aug}} \end{bmatrix}\)</span></li>
<li>计算下一时刻约束：<span class="arithmatex">\(J_{\text{LP}} \leftarrow H_{\text{aug}}K_{\text{aug}}A_K^{t+1}\)</span></li>
<li>
<p><strong>for</strong> <span class="arithmatex">\(i = 1\)</span> <strong>to</strong> <span class="arithmatex">\(s\)</span> <strong>do</strong>:
   $J_{next} \leftarrow \max_x \  J_{LP}[i] x \quad \text{subj.to.} \  \  A_{LP} x &lt; b_{LP} $
   <strong>if</strong> <span class="arithmatex">\(J_{\text{next}}^{(i)} &lt; h^{(i)},\ \forall i \in \{1,...,s\}\)</span> <strong>then</strong>:
   <span class="arithmatex">\(p_f \leftarrow 1,\quad \mathcal{X}_f \leftarrow \{x \in \mathbb{R}^n | \mathcal{A}_{\text{LP}}x \preceq \mathcal{B}_{\text{LP}}\}\)</span></p>
</li>
<li>
<p><span class="arithmatex">\(t \leftarrow t + 1\)</span></p>
</li>
</ol>
<p><strong>end while</strong></p>
<p><strong>return</strong> <span class="arithmatex">\(\mathcal{X}_f\)</span></p>
</div>
<h2 id="_2">基于最大椭球集/半定规划的终端集求解</h2>
<p>对于离散线性系统</p>
<div class="arithmatex">\[
  x(k+1) = A x(k) + B u(k),
\]</div>
<p>设计一个椭球集作为终端约束集合：</p>
<div class="arithmatex">\[
  \mathcal X_f := \{ x|x^\top P x \leq 1 \} \subset \mathcal X
\]</div>
<p>使其既保证闭环稳定，又满足：</p>
<ul>
<li>内部稳定性：$ x<em>k \in \mathcal{X}_f \Rightarrow x</em>{k+1} \in \mathcal{X}_f$，</li>
<li>状态约束：$ H_x x \leq h_x $，</li>
<li>输入约束：$ H_u u \leq h_u $。</li>
</ul>
<div class="admonition note">
<ul>
<li>求终端集用到的<span class="arithmatex">\(P\)</span>不需要与终端代价中的<span class="arithmatex">\(P\)</span>相等。 </li>
<li>寻找最大的终端集就是寻找最小的<span class="arithmatex">\(\det P\)</span>，因此后续的推导过程中需要把离散 Lyapunov 方程变成不等式形式。 </li>
<li><span class="arithmatex">\(\det P\)</span>反映的是椭球集各轴综合缩放程度，因此<span class="arithmatex">\(\det P\)</span>越小，椭球集越大。</li>
</ul>
</div>
<h3 id="_3">内部稳定性</h3>
<p>根据<a href="../01-%E5%B8%B8%E7%94%A8%E5%AE%9A%E7%90%86%E3%80%81%E7%9F%A9%E9%98%B5/#def:dis_Lya_func">离散Lyapunov方程</a>，<span class="arithmatex">\(P\)</span>需要满足如下条件：</p>
<div class="arithmatex">\[
  (A + BK)^\top P (A +BK ) - P = -(Q + K^\top R K) \preceq 0.
\]</div>
<p>为了求最大终端集（椭球集），令</p>
<div class="arithmatex">\[
  (A + BK)^\top P (A +BK ) - P \preceq -(Q + K^\top R K).
\]</div>
<p>为了将上述非线性约束转化为线性矩阵约束(LMI)，进行变量替换：</p>
<div class="arithmatex">\[
\begin{aligned}
E &amp;= P^{-1} \succ 0, \\
Y &amp;= K E \Rightarrow K = Y E^{-1}.
\end{aligned}
\]</div>
<p>带入上式，并左乘右乘$ E <span class="arithmatex">\(可得（注：\)</span> E $是对称矩阵）：</p>
<div class="arithmatex">\[
  E (A + B Y E^{-1})^\top E^{-1} (A + B Y E^{-1}) E - E + E(Q)E + Y^\top R Y,
\]</div>
<p>展开后化简为：</p>
<div class="arithmatex">\[
  (AE + BY)^\top E^{-1} (AE + BY) - E + E Q E + Y^\top R Y \preceq 0.
\]</div>
<p>其中，单独看前两项，通过 shur 补引理可以转化为：</p>
<div class="arithmatex">\[
\begin{bmatrix}
-E &amp; (AE + BY)^\top \\
AE + BY &amp; -E
\end{bmatrix}
=\begin{bmatrix}
-E &amp; EA^\top + Y^\top B^\top \\
AE + BY &amp; -E
\end{bmatrix}
\preceq 0.
\]</div>
<p>后两项可以分解为：</p>
<div class="arithmatex">\[
E Q E + Y^\top R Y =
\begin{bmatrix}
E Q^{\frac 1 2} &amp; Y^\top R^{\frac 1 2} \\
\end{bmatrix}
\begin{bmatrix}
Q^{\frac 1 2} E \\
R^{\frac 1 2} Y
\end{bmatrix}.
\]</div>
<p>进一步地，通过构造分块矩阵，可以得到公式(\ref{eq3:lya_func})的完整等价 LMI 如下：</p>
<div class="arithmatex">\[
\begin{bmatrix}
-E &amp; (AE + BY)^\top &amp; Q^{1/2} E &amp; Y^\top R^{1/2} \\
AE + BY &amp; -E &amp; 0 &amp; 0 \\
E Q^{1/2} &amp; 0 &amp; -I &amp; 0 \\
R^{1/2} Y &amp; 0 &amp; 0 &amp; -I
\end{bmatrix} \preceq 0.
\]</div>
<h3 id="_4">约束处理</h3>
<p>向量 $ H_{x, i} x $ 的极大值出现在椭圆边界的切点（由椭圆半轴长公式，推导自拉格朗日极值）：</p>
<div class="arithmatex">\[
  \max_{x \in \mathcal{X}_f} H_{x, i} x = \sqrt{ H_{x, i} E H_{x, i}^\top }.
\]</div>
<p>因此，状态约束的等价条件为（平方后应用 shur 补引理）：</p>
<div class="arithmatex">\[
  H_{x, i} E H_{x, i}^\top \leq h_{x, i}^2 \Rightarrow
  \begin{bmatrix}
  h_{x, i}^2 &amp; H_{x, i} E \\
  E H_{x, i}^\top &amp; I
  \end{bmatrix} \succeq 0.
\]</div>
<p>同理，控制约束的等价 LMI 表述为：</p>
<div class="arithmatex">\[
  \max_{x \in \mathcal{X}_f} H_{u, j} u = \sqrt{H_{u, j} Y E^{-1} E E^{-1} Y^\top H_{u, j}^\top} = \sqrt{H_{u, j} Y E^{-1} Y^\top H_{u, j}^\top},
\]</div>
<div class="arithmatex">\[
H_{u, j} Y E^{-1} Y^\top H_{u, j}^\top \leq h_{u, j}^2  \Rightarrow
\begin{bmatrix}
h_{u, j}^2 &amp; H_{u, j} Y \\
Y^\top H_{u, j}^\top &amp; E
\end{bmatrix} \succeq 0.
\]</div>
<h3 id="_5">优化问题构造</h3>
<p>综上所述，可以构造如下优化问题来求解终端集（稳定性中的<span class="arithmatex">\(\preceq\)</span>变为<span class="arithmatex">\(\succeq\)</span>）：</p>
<div class="arithmatex">\[
    \begin{aligned}
    \min_{E, Y} \  &amp; -\log \det E \\
    \text{subj.to.} \  &amp; E \succeq 0\\
    &amp;
    \begin{bmatrix}
    E &amp; (AE + BY)^\top &amp; Q^{1/2} E &amp; Y^\top R^{1/2} \\
    * &amp; * &amp; 0 &amp; 0 \\
    * &amp; * &amp; I &amp; 0 \\
    * &amp; * &amp; * &amp; I
    \end{bmatrix} \succeq 0, \\
    &amp;
    \begin{bmatrix}
    h_{x, i}^2 &amp; H_{x, i} E \\
    E H_{x, i}^\top &amp; I
    \end{bmatrix} \succeq 0, \\
    &amp;
    \begin{bmatrix}
    h_{u, j}^2 &amp; H_{u, j} Y \\
    Y^\top H_{u, j}^\top &amp; E
    \end{bmatrix} \succeq 0.
    \end{aligned}
\]</div>
<h2 id="_6">线性时变系统终端集求解（基于最大椭球集/半定规划）</h2>
<p>考虑一个离散时间线性时变系统，其动态矩阵 <span class="arithmatex">\(A_k(p)\)</span> 和 <span class="arithmatex">\(B_k(p)\)</span> 是参数 <span class="arithmatex">\(p\)</span> 的函数：</p>
<div class="arithmatex">\[
  x(k+1) = A_k(p)x(k) + B_k(p)u(k),
\]</div>
<p>其中<span class="arithmatex">\(p \in \mathcal{P} \subseteq \mathbb{R}^d\)</span> 是系统的时变参数，取值范围为 <span class="arithmatex">\(\mathcal{P}\)</span>；
<span class="arithmatex">\(A_k(p) \in \mathbb{R}^{n \times n}\)</span> 和 <span class="arithmatex">\(B_k(p) \in \mathbb{R}^{n \times m}\)</span> 是参数化的系统矩阵。</p>
<p>系统的目标是设计一个固定的终端控制律 <span class="arithmatex">\(u = Kx\)</span> 和一个终端不变集 <span class="arithmatex">\(\mathcal{X}_f\)</span>，使得：</p>
<ul>
<li>闭环系统 <span class="arithmatex">\(x(k+1) = (A_k(p) + B_k(p)K)x(k)\)</span> 在参数 <span class="arithmatex">\(p \in \mathcal{P}\)</span> 的所有取值下是稳定的；</li>
<li>状态 <span class="arithmatex">\(x(k)\)</span> 和控制输入 <span class="arithmatex">\(u(k)\)</span> 满足给定的状态约束和控制约束；</li>
<li>终端不变集 <span class="arithmatex">\(\mathcal{X}_f\)</span> 是闭环系统的正不变集。</li>
</ul>
<p>终端集的求解思路和线性时不变系统一样，但是需要满足所有参数下的状态矩阵和控制矩阵。</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../05-MPC%E7%A8%B3%E5%AE%9A%E6%80%A7%E7%9A%84%E5%BA%94%E7%94%A8/" class="btn btn-neutral float-right" title="MPC稳定性的应用">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../03-%E6%9C%89%E9%99%90%E6%97%B6%E5%9F%9F%E7%BA%BF%E6%80%A7%E6%9C%89%E7%BA%A6%E6%9D%9FMPC%E7%A8%B3%E5%AE%9A%E6%80%A7%E6%8E%A8%E5%AF%BC/" class="btn btn-neutral" title="有限时域线性有约束MPC稳定性推导"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../03-%E6%9C%89%E9%99%90%E6%97%B6%E5%9F%9F%E7%BA%BF%E6%80%A7%E6%9C%89%E7%BA%A6%E6%9D%9FMPC%E7%A8%B3%E5%AE%9A%E6%80%A7%E6%8E%A8%E5%AF%BC/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../05-MPC%E7%A8%B3%E5%AE%9A%E6%80%A7%E7%9A%84%E5%BA%94%E7%94%A8/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.js" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/contrib/auto-render.min.js" defer></script>
      <script src="../../javascripts/katex-init.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
